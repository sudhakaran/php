/*1301360020,176820663*/

if (window.CavalryLogger) { CavalryLogger.start_js(["QgoTM"]); }

ConnectLogin={init:function(a){this.appID=a.appID;this.oneClick=a.oneClick;XD.init(a);},login:function(a,c,b){if(this.oneClick&&!c){this._oneClick(a);}else this._openPopup(a,c,b);},logout:function(){XD.send({type:'logout'});},_oneClick:function(a){new AsyncRequest().setURI('/ajax/api/tos.php').setData({app_id:this.appID,grant_perm:1}).setHandler(function(b){ConnectLogin._refreshLoginStatus();a&&a();}).send();},_openPopup:function(c,e,d){d=d||{};var b=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();if(ConnectLogin.appID)ConnectLogin._refreshLoginStatus();c&&c();}),a=WindowComm.makeHandler(function(h){ConnectLogin._closePopup();}),g=new URI('/login.php');g.setQueryData({api_key:this.appID,next:b,channel_url:a,cancel_url:a,req_perms:e,v:'1.0',fbconnect:1,display:'popup'});g.addQueryData(d);var f=this._getSize(d);this._popup=PopupResizer.open(g.toString(),f.height,f.width);},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}},_refreshLoginStatus:function(){XD.send({type:'refreshLoginStatus'});},_getSize:function(a){if(a.social_plugin=='registration'){return {width:640,height:370};}else return {width:610,height:280};}};
FBCommentServer={serverStarted:true,init:function(a){CSS.setClass($(a.commentsID).parentNode,'mu-connect-disable-logout');this._notifyAddComment=a.notify;ConnectLogin.init(a);XD.init({channelUrl:a.channelUrl,hideOverflow:true,autoResize:true});},showConnect:function(){ConnectLogin.login();},setupConnect:function(a,b){if(Env.user){a.defer();}else b.defer();},addComment:function(a){if(this._notifyAddComment)XD.send({type:'addComment',comments:a});}};
function GenericPager(){copy_properties(this,{callback:null,hidecallback:null,showcallback:null,max_per_page:10,total:0,currentcount:0,currentpage:0,blocks:[],pagersize:5,pagerlinks:{next:true,last:true,prev:true,first:true}});return this;}copy_properties(GenericPager.prototype,{setCallback:function(a){this.callback=a;return this;},setHideCallback:function(a){this.hidecallback=a;return this;},setShowCallback:function(a){this.showcallback=a;return this;},setDisplayBlocks:function(a){this.blocks=a;return this;},setMaxPerPage:function(a){this.max_per_page=a;return this;},setTotal:function(a){this.total=a;return this;},setPagerSize:function(a){this.pagersize=a;return this;},setLinks:function(a){this.pagerlinks=a;return this;},render:function(){for(var a=0;a<this.blocks.length;a++)this._renderBlock(this.blocks[a]);return this;},_renderBlock:function(a){var f=$N('ul',{className:'pagerpro'});var e=Math.ceil(this.total/this.max_per_page);var d=Math.max(0,Math.min(this.currentpage-Math.ceil(this.pagersize/2),e-this.pagersize));if(1==e){this.hidecallback();}else this.showcallback();var b=[];if(this.currentpage!=0){if(this.pagerlinks.first&&(!this.pagerlinks['prev']||this.currentpage!=1))b.push(this._makeLI(_tx("First"),0,false));if(this.pagerlinks.prev)b.push(this._makeLI(_tx("Prev"),this.currentpage-1,false));}for(var c=d;c<Math.min(d+this.pagersize,e);c++)b.push(this._makeLI(c+1,c,c==this.currentpage));if(this.currentpage<e-1){if(this.pagerlinks.next)b.push(this._makeLI(_tx("Next"),this.currentpage+1,false));if(this.pagerlinks.last&&e>d+this.pagersize)b.push(this._makeLI(_tx("Last"),e-1,false));}DOM.setContent(f,b);DOM.setContent(a,f);},_makeLI:function(d,e,b){var c=$N('li',{className:'pagerpro_li'});var a=$N('a',{href:'#',className:'pagerpro_a'});DOM.setContent(c,a);DOM.setContent(a,d);if(b){CSS.addClass(c,"current");Event.listen(a,'click',Event.kill);}else Event.listen(a,'click',this._setPage.bind(this,e));return c;},_setPage:function(a){this.currentpage=a;this.currentcount=this.currentpage*this.max_per_page;this.callback(this.currentpage+1,this.max_per_page);this.render();return false;},reset:function(a){if(!a)a=0;if(this.currentpage!=a){this.currentpage=a;this.currentcount=this.currentpage*this.max_per_page;this.callback(this.currentpage+1,this.max_per_page);this.render();}return this;},resetView:function(){var a=Math.ceil(this.total/this.max_per_page);if(this.currentpage>=a)this.currentpage=Math.max(a-1,0);this.callback(this.currentpage+1,this.max_per_page);this.render();return this;},getCurrentPage:function(){return this.currentpage;}});
function WallKit(b){var a=$(b);WallKit.getServer=function(){return window.FBCommentServer||window.FB&&window.FB.CommentServer;};copy_properties(this,{frameId:b,frame:a,commentsdiv:DOM.find(a,'div.comment_body'),postsdiv:DOM.find(a,'div.wallkit_posts'),subtitles:DOM.scry(a,'div.wallkit_subtitle div.post_counter'),form:DOM.find(a,'form'),loadgif:DOM.find(a,'div.loading_page'),profilepic:DOM.find(a,'div.profile_pic'),captcha:false,hideform:false,latestUpdate:0,settingsopen:false,post_blacklist:{maxct:true,count:true,total:true,post_to_profile:true},tempPosts:{},formdiv:DOM.find(a,'div.wallkit_form')});copy_properties(this,{wallCaptcha:DOM.scry(this.form,'div.wall_captcha')[0],submit:DOM.find(this.form,'.post input[type="submit"]'),text:DOM.find(this.form,'textarea[name="wall_text"]'),postformid:DOM.find(this.form,' input[name="post_form_id"]'),fb_dtsg:DOM.find(this.form,' input[name="fb_dtsg"]'),maxct:DOM.find(this.form,'input[name="maxct"]'),count:DOM.find(this.form,'input[name="count"]'),total:DOM.find(this.form,'input[name="total"]'),xid:DOM.find(this.form,'input[name="xid"]'),reverse:DOM.find(this.form,'input[name="reverse"]'),post_area:DOM.find(this.form,'div.post_area')});var c=DOM.scry(this.form,'div.toggleform');if(c.length>0){this.hideform=true;this.toggleform=c[0];Event.listen(this.toggleform,'click',function(d){CSS.addClass(this.toggleform,'hidden');CSS.removeClass(this.post_area,'hidden');CSS.removeClass(this.profilepic,'hidden');CSS.removeClass(this.text.parentNode,'hidden');CSS.removeClass(this.loadgif,'pic_hidden');this.text.focus();}.bind(this));}Event.listen(this.submit,'click',this.wallPost.bind(this));this.external_wallkit=(DOM.scry(this.form,'input[name="connected"]').length>0);this.post_to_profile=DOM.find(this.form,'div.post_area input[name="post_to_profile"]');if(this.external_wallkit){this.connected=DOM.find(this.form,'input[name="connected"]');this.loggedinuser=DOM.find(this.form,'input[name="loggedin"]');this.userpic=DOM.find(this.form,'img.connected');this.anonpic=DOM.find(this.form,'img.not_connected');this.namelink=DOM.find(this.form,'span.namelink');this.comment_setup=false;this.connecting=false;this.initCommentServer();this.connect_button=DOM.find(a,'div.connect_button_text .connect_button');Event.listen(this.connect_button,'click',function(d){d.kill();try{WallKit.getServer().showConnect();}catch(e){ConnectSocialWidget.login(null,'wallkit');}}.bind(this));this.logout_link=DOM.find(this.form,'div.connected a.logout');Event.listen(this.logout_link,'click',function(d){d.kill();try{WallKit.getServer().logout();}catch(e){var logout_uri=new URI($('real_logout_link').href);logout_uri.addQueryData({next:window.location.href});window.location=logout_uri.toString();}}.bind(this));DOM.insertAfter(DOM.find(this.form,'div.connect_area'),this.wallCaptcha);this.nameinput=DOM.find(this.form,'div.nameemail input[name="name"]');this.emailinput=DOM.find(this.form,'div.nameemail input[name="email"]');Event.listen(this.nameinput,'focus',this.showAnonymousCaptcha.bind(this));Event.listen(this.emailinput,'focus',this.showAnonymousCaptcha.bind(this));Input.setPlaceholder(this.nameinput,this.nameinput.value);Input.setPlaceholder(this.emailinput,this.emailinput.value);}else DOM.insertAfter(this.text,this.wallCaptcha);CSS.hide(this.wallCaptcha);this.pagers=DOM.scry(a,'div.pager');this.pipe=DOM.scry(a,'span.pipe');this.registerLinks(a);this.genericpager=new GenericPager().setCallback(this.showPosts.bind(this)).setHideCallback(function(){this.pagers.map(hide);this.pipe.map(hide);}.bind(this)).setShowCallback(function(){this.pagers.map(show);this.pipe.map(show);}.bind(this)).setDisplayBlocks(this.pagers).setMaxPerPage(parseInt(this.maxct.value)).setTotal(parseInt(this.total.value)).render();if(!(this.external_wallkit))this.genericpager.resetView();}copy_properties(WallKit.prototype,{wallPost:function(event){event.kill();var b=Input.getValue(this.text);if(!b||b==''){animation(this.text).from('background','#ffcccc').to('background','#fff').duration(120).go();return;}var d='/ajax/wallpost_ajax.php';if(this.external_wallkit&&this.connected.value==0){var e=Input.getValue(this.nameinput);var c=Input.getValue(this.emailinput);if(!e||e==''){animation(this.nameinput).from('background','#ffcccc').to('background','#fff').duration(120).go();return;}d='/ajax/wallkit_anonpost.php';}this.genericpager.reset();this.submit.disabled=true;CSS.addClass(this.submit,'inputsubmit-disabled');show(this.loadgif);var a=this.getFormVars();a.wall_text=b;if(this.post_to_profile.checked)a.feed_story=1;if(this.external_wallkit&&this.connected.value==0){a.name=e;a.email=c;}if(this.captcha){this.text.disabled=false;this.captcha=false;if(!this.external_wallkit||this.connected.value)CSS.hide(this.wallCaptcha);}new AsyncRequest().setURI(d).setHandler(this.onDone.bind(this)).setErrorHandler(function(f){AsyncResponse.defaultErrorHandler(f);this.submit.disabled=false;CSS.removeClass(this.submit,'inputsubmit-disabled');hide(this.loadgif);}.bind(this)).setData(a).send();},setLinks:function(a){this.pagerlinks=a;this.genericpager.setLinks(this.pagerlinks).render();return this;},registerLinks:function(b){if(this.external_wallkit){var d=DOM.scry(b,'a');d.forEach(function(h){h.target='_blank';});}var e=DOM.scry(b,'a.message');e.forEach(this._setMessageHandler.bind(this));var c=DOM.scry(b,'a.delete');c.forEach(this._setDeleteHandler.bind(this));var a=DOM.scry(b,'a.block');a.forEach(this._setBlockHandler.bind(this));var g=DOM.scry(b,'a.unblock');g.forEach(this._setUnblockHandler.bind(this));var f=DOM.scry(b,'a.report');f.forEach(this._setReportHandler.bind(this));},initCommentServer:function(){try{if(!this.comment_setup&&WallKit.getServer()&&WallKit.getServer().serverStarted){this.comment_setup=true;WallKit.getServer().setupConnect(this.connectUser.bind(this),this.logoutUser.bind(this));}else this.initCommentServer.bind(this).defer(100);}catch(a){}},connectUser:function(){if(!this.connected.value){this.connected.value=1;CSS.hide(this.wallCaptcha);this.captcha=false;if(!this.connecting){var a=this.getFormVars();this.connecting=true;new AsyncRequest().setURI('/ajax/wallkit_connect.php').setData(a).setHandler(function(d){var b=DOM.find(this.form,'div.show_not_connected');CSS.removeClass(b,'show_not_connected');CSS.addClass(b,'show_connected');var c=d.getPayload();this.loggedinuser.value=c.user;this.userpic.src=c.picture;this.postformid.value=c.post_form_id;this.fb_dtsg.value=c.fb_dtsg;DOM.setContent(this.namelink,HTML(c.namelink));this.registerLinks(this.namelink);this.showEditSettings(c.editsettings);this.genericpager.resetView();this.connecting=false;}.bind(this)).send();}}},logoutUser:function(){if(this.connected.value){this.connected.value='';var b=DOM.find(this.form,'div.show_connected');CSS.removeClass(b,'show_connected');CSS.addClass(b,'show_not_connected');this.loggedinuser.value=0;var a=this.getFormVars();a.logout=true;new AsyncRequest().setURI('/ajax/wallkit_connect.php').setData(a).setHandler(function(d){var c=d.getPayload();this.postformid.value=c.post_form_id;this.fb_dtsg.value=c.fb_dtsg;this.genericpager.resetView();success=false;this.showEditSettings(c.editsettings);DOM.setContent(this.wallCaptcha,HTML(c.captchaCode));Event.listen(DOM.find(this.form,'div.nameemail'),'click',this.showAnonymousCaptcha.bind(this));CSS.hide(this.wallCaptcha);}.bind(this)).send();}},showAnonymousCaptcha:function(event){if(!this.captcha){this.captcha=true;animation(this.wallCaptcha).show().from('opacity',0).to('opacity',1).duration(200).go();}},_setMessageHandler:function(a){var c=new URI(a.href).getQueryData();var b='/ajax/messaging/composer.php?id='+c.id;Event.listen(a,'click',function(){new Dialog().setAsync(new AsyncRequest().setURI(b)).show();return false;});return false;},_setDeleteHandler:function(a){var b=new URI(a.href).getQueryData();Event.listen(a,'click',function(event){var c=new Dialog().setTitle(_tx("Delete Post")).setBody(_tx("Are you sure you want to delete this post?")).setButtons([Dialog.newButton('delete',_tx("Delete")),Dialog.CANCEL]).setHandler(function(event){var d=b;d[this.postformid.name]=this.postformid.value;d.fb_dtsg=this.fb_dtsg.value;new AsyncRequest().setURI('/ajax/wallkit_edit.php').setHandler(this._deletePost.bind(this,b.cdel)).setData(d).send();}.bind(this)).show();return false;}.bind(this));},_setBlockHandler:function(a){var b=new URI(a.href).getQueryData();Event.listen(a,'click',function(event){var c=new Dialog().setTitle(_tx("Block user?")).setBody(_tx("Are you sure you want to block this user?")).setButtons([Dialog.newButton('block',_tx("Block")),Dialog.CANCEL]).setHandler(function(event){var d=b;d[this.postformid.name]=this.postformid.value;d.fb_dtsg=this.fb_dtsg.value;new AsyncRequest().setURI('/ajax/wallkit_edit.php').setHandler(this.genericpager.resetView.bind(this.genericpager)).setData(d).send();}.bind(this)).show();return false;}.bind(this));},_setUnblockHandler:function(a){var b=new URI(a.href).getQueryData();Event.listen(a,'click',function(event){var c=b;c[this.postformid.name]=this.postformid.value;c.fb_dtsg=this.fb_dtsg.value;new AsyncRequest().setURI('/ajax/wallkit_edit.php').setHandler(this.genericpager.resetView.bind(this.genericpager)).setData(c).send();event.kill();}.bind(this));},_setReportHandler:function(a){Event.listen(a,'click',function(){new Dialog().setAsync(new AsyncRequest().setURI(new URI(a.href))).show();return false;});return false;},_deletePost:function(a,b){this.total.value=parseInt(this.total.value)-1;this.genericpager.setTotal(this.total.value);this.genericpager.resetView();},showEditSettings:function(a){var d=DOM.scry(this.form,'a.editsettings');d.forEach(function(e){DOM.remove(e);});if(!a)return this;if(a.blacklisted){CSS.addClass(DOM.find(this.form,'div.text_spacer'),'hidden');}else CSS.removeClass(DOM.find(this.form,'div.text_spacer'),'hidden');if(a.can_post){CSS.removeClass(DOM.find(this.form,'div.post_area'),'hidden');}else CSS.addClass(DOM.find(this.form,'div.post_area'),'hidden');if(a.allow_anon){CSS.removeClass(DOM.find(this.form,'div.nameemail'),'hidden');CSS.removeClass(DOM.find(this.form,'div.or'),'hidden');CSS.addClass(DOM.find(this.form,'div.hint_text'),'anon');}else{CSS.addClass(DOM.find(this.form,'div.nameemail'),'hidden');CSS.addClass(DOM.find(this.form,'div.or'),'hidden');CSS.removeClass(DOM.find(this.form,'div.hint_text'),'anon');}var c='';if(a.is_mod){c=_tx("Administer Comments");}else return this;var b=$N('a',{className:'editsettings'},c);Event.listen(b,'click',function(f){var e=this.getFormVars();if(!this.settingsopen){new AsyncRequest().setURI('/ajax/widget_settings.php').setHandler(this._editSettingsHandler.bind(this)).setData(e).send();show(this.loadgif);this.settingsopen=true;}f.kill();}.bind(this));DOM.insertAfter(DOM.find(this.form,'div.composer'),b);return this;},_editSettingsHandler:function(c){hide(this.loadgif);var b=c.getPayload();var a=$N('div');DOM.setContent(a,HTML(b));hide(this.commentsdiv);DOM.insertAfter(this.commentsdiv,a);Arbiter.subscribe('widgets/settings/'+DOM.find(a,'form').id,function(e,d){if(d.action=='close'){DOM.remove(a);show(this.commentsdiv);this.settingsopen=false;hide(this.loadgif);this.genericpager.resetView();}else if(d.action=='submitting')show(this.loadgif);}.bind(this));},setLatestUpdate:function(a){this.latestUpdate=a;},refreshView:function(){if(this.genericpager.getCurrentPage()==0){var b=DOM.scry(this.postsdiv,'span.time');var c=parseInt(this.maxct.value);var a=this.getFormVars();a.page=1;a.pgsize=c;a.start_time=this.latestUpdate;new AsyncRequest().setURI('/ajax/wallkit_get.php').setHandler(this.onRefreshPosts.bind(this)).setErrorHandler(function(){}).setData(a).send();}},onRefreshPosts:function(f){var e=f.getPayload();if(this.genericpager.getCurrentPage()==0&&e){var c=parseInt(this.maxct.value);var d=DOM.scry($N('div',{},HTML(e.posts)),'div.wallkit_post');var a=DOM.scry(this.postsdiv,'div.wallkit_post');if(e.is_delete_update){a.forEach(DOM.remove);a=[];}var g=a.length;for(var b=d.length-1;b>=0;b--){if(this.tempPosts[d[b].id]!=null){this.tempPosts[d[b].id]=null;continue;}animation(d[b]).from('opacity',0).to('opacity',1).go();if(this.reverse.value){DOM.appendContent(this.postsdiv,d[b]);removeTarget=this.postsdiv.firstChild;}else{DOM.prependContent(this.postsdiv,d[b]);removeTarget=this.postsdiv.lastChild;}if(++g>c){DOM.remove(this.postsdiv.lastChild);g--;}this.registerLinks(d[b]);}if(e.total&&e.total!=this.total.value){this.total.value=e.total;this.genericpager.setTotal(this.total.value).render();}this.setLatestUpdate(e.latestUpdate);this.subtitles.forEach(function(h){DOM.setContent(h,HTML(this.getPostCounter(1,parseInt(this.maxct.value),this.total.value)));}.bind(this));}},getFormVars:function(){var c=DOM.scry(this.form,'input');var a={};for(var b=0;b<c.length;b++)if(c[b].name&&!this.post_blacklist[c[b].name])a[c[b].name]=c[b].value;return a;},onDone:function(g){var e=g.getPayload();var h=true;this.submit.disabled=false;CSS.removeClass(this.submit,'inputsubmit-disabled');hide(this.loadgif);if(e.captcha){h=false;DOM.setContent(this.wallCaptcha,HTML(e.captchaCode));this.captcha=true;CSS.show(this.wallCaptcha);}else if(e.wp){var c=$N('div',{},HTML(e.wp)).firstChild;var f=null;animation(c).from('opacity',0).to('opacity',1).go();if(this.reverse.value){DOM.appendContent(this.postsdiv,c);this.registerLinks(this.postsdiv.lastChild);f=this.postsdiv.firstChild;}else{DOM.prependContent(this.postsdiv,c);this.registerLinks(this.postsdiv.firstChild);f=this.postsdiv.lastChild;}this.tempPosts[c.id]=c;var a=parseInt(this.count.value);var i=parseInt(this.total.value);var b=parseInt(this.maxct.value);a++;i++;if(a>b){a=b;DOM.remove(f);}this.count.value=a;this.total.value=i;this.genericpager.setTotal(i).render();this.subtitles.forEach(function(j){DOM.setContent(j,HTML(this.getPostCounter(1,a,i)));}.bind(this));}if(h){if(this.hideform){CSS.removeClass(this.toggleform,'hidden');CSS.addClass(this.post_area,'hidden');CSS.addClass(this.profilepic,'hidden');CSS.addClass(this.text.parentNode,'hidden');CSS.addClass(this.loadgif,'pic_hidden');}if(this.external_wallkit){if(!this.connected.value&&Recaptcha)Recaptcha.reload();try{if(WallKit.getServer().addComment){var comment={post:Input.getValue(this.text),user:e.user};WallKit.getServer().addComment(comment);}}catch(d){}}this.text.value='';this.text.focus();(function(){this.text.blur();}).bind(this).defer(10);}},showPosts:function(b,c){var a=this.getFormVars();a.page=b;a.pgsize=c;show(this.loadgif);new AsyncRequest().setURI('/ajax/wallkit_get.php').setHandler(this.onReplacePosts.bind(this,b,c)).setData(a).send();},onReplacePosts:function(a,c,d){var b=d.getPayload();hide(this.loadgif);DOM.setContent(this.postsdiv,HTML(b.posts));if(b.total&&b.total!=this.total.value){this.total.value=b.total;this.genericpager.setTotal(parseInt(this.total.value)).render();}if(a==1)this.setLatestUpdate(b.latestUpdate);this.subtitles.forEach(function(e){DOM.setContent(e,this.getPostCounter((a-1)*c+1,(a-1)*c+b.numposts,this.total.value));}.bind(this));this.registerLinks(this.postsdiv);},getPostCounter:function(c,a,d){var b='';if(!(d==0))if(c>1||d>a){b=_tx("Displaying {number} of {total-link}.",{number:c+'-'+a,'total-link':_tx("{number} posts",{number:d})});}else if(a==d&&d==2){b=_tx("Displaying the only 2 posts.");}else if(a>=d&&d>1){b=_tx("Displaying all {number} posts.",{number:d});}else if(c==d&&d==1)b=_tx("Displaying the only post.");return b;}});